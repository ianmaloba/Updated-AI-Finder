{% extends "base.html" %}

{% load custom_filters %}

{% block title %}Home{% endblock %}

{% block content %}

<br>
<div class="container">
    <p class="auto-typed-text"><span class="auto-type"></span></p>
</div>
<script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>
<script>
    var totalCount = {{ all_ai_tools_count }};

    var typed = new Typed(".auto-type", {
        strings: [
            totalCount + "+ AI Tools As at Now",
            "Database Updated Automatically"
        ],
        typeSpeed: 50,
        backSpeed: 35,
        loop: true
    });
</script>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <!-- Left Side: Search and Filter -->
            <h3>Filter And Search</h3>
            <p><i>Fill in part or whole of the form and click search.. or try <a href="{% url 'google_custom_search' %}" class="text-bold">Custom Search Engine</a></i></p>
            <div class="filter-part">
                <form id="search-form" method="GET" action="{% url 'search_results' %}">
                    <div class="row">
                        <div class="form-group col-md-12">
                            <!-- Enlarged text input field -->
                            <label for="ai_name_contains">What kind of AI tool are you looking for?</label>
                            <textarea class="form-control" id="ai_name_contains" name="ai_name_contains" placeholder="Explain briefly..." rows="3" style="border: 1px solid blue;"></textarea>
                        </div>
                        <div class="form-group col-md-12">
                            <!-- Full width input fields -->
                            <input class="form-control" type="search" name="ai_short_description__icontains" placeholder="AI Name Contains..." style="border: 1px solid blue;" />
                        </div>
                        <div class="form-group col-md-6">
                            <!-- Half width input fields -->
                            <label for="publishDateMin">Launched Before</label>
                            <input type="date" class="form-control" id="publishDateMin" name="date_min" style="border: 1px solid blue;">
                        </div>
                        <div class="form-group col-md-6">
                            <!-- Half width input fields -->
                            <label for="category">AI Type</label>
                            <select id="category" class="form-control" name="ai_type" style="border: 1px solid blue;">
                                <option value="">Choose...</option>
                                <option value="Video">Video</option>
                                <option value="Text">Text</option>
                                <option value="Audio">Audio</option>
                                <option value="Assistant">Assistant</option>
                                <option value="Business">Business</option>
                                <option value="Trading">Trading</option>
                                <option value="GPT">GPT</option>
                            </select>
                        </div>
                        <div class="form-group col-md-12">
                            <!-- Full width input fields -->
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="free" value="true" {% if query_params.free == 'true' %}checked{% endif %} style="border: 1px solid lightblue;">
                                <label class="form-check-label" for="free">Free</label>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Search</button>
                </form>  
            </div>
            <hr>
            <p><i>OR Search by ai tool id..</i></p>
            <div class="filter-part">
                <form method="GET" action="{% url 'search_results' %}">
                    <div class="row">
                        <div class="form-group col-md-12">
                            <!-- Full width input fields -->
                            <input class="form-control" style="border: 1px solid blue;" type="number" name="ai_exact_id" placeholder="Enter AI Tool ID" />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Search</button>
                </form>
            </div>
            <hr>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" style="display: none; text-align: center; margin-top: 20px;">
            <div class="spinner" style="display: inline-block; width: 50px; height: 50px; border: 5px solid lightblue; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p>Searching...</p>
        </div>

        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            #loading {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 9999;
                text-align: center;
                display: none; /* Hide by default */
            }
            .spinner {
                width: 300px; /* Increase size */
                height: 300px;
                border: 25px solid lightblue; /* Thicker border */
                border-top: 25px solid #3498db; /* Spinner color */
                border-radius: 50%;
                animation: spin 0.8s linear infinite; /* Adjust speed */
            }
        </style>

        <div id="loading">
            <div class="spinner"></div>
        </div>

        <script>
            document.getElementById('search-form').addEventListener('submit', function() {
                document.getElementById('loading').style.display = 'block';
            });

            // Hide spinner on page load or back navigation
            window.addEventListener('pageshow', function(event) {
                if (event.persisted || window.performance && window.performance.navigation.type == 2) {
                    document.getElementById('loading').style.display = 'none';
                }
            });
        </script>


        <div class="col-md-6">
            <!-- Right Side: Categories and Tags -->
            <div>
                <h3>Popular Categories</h3>
                {% for category, count in popular_categories %}
                    <a href="{% url 'category_tools' category_slug=category.slug %}" class="frontpage-tags">
                        <button class="category-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 16 16">
                                <g fill="none">
                                    <g clip-path="url(#gravityUiHandPointRight0)">
                                        <path fill="red" fill-rule="evenodd" d="m2.5 6l2.906-3.737a1.978 1.978 0 0 1 3.48 1.694L8.626 5h5.432a1.942 1.942 0 0 1 .421 3.838L11.5 9.5l-.457 2.744a3 3 0 0 1-3.732 2.405L3 13.5zm5.197 7.2l-3.272-.872l-.39-5.858L6.59 3.184a.478.478 0 0 1 .84.41l-.26 1.042L6.704 6.5h7.354a.442.442 0 0 1 .096.874l-2.98.662l-.987.22l-.166.997l-.458 2.744A1.5 1.5 0 0 1 7.697 13.2m-7.195.103a.75.75 0 0 0 1.496-.106l-.5-7a.75.75 0 1 0-1.496.106z" clip-rule="evenodd"/>
                                    </g>
                                    <defs>
                                        <clipPath id="gravityUiHandPointRight0">
                                            <path fill="red" d="M0 0h16v16H0z"/>
                                        </clipPath>
                                    </defs>
                                </g>
                            </svg>
                            {{ category.name }} ({{ count }})
                        </button>
                    </a>
                {% endfor %}
                • • • • •
                <a href="{% url 'all_categories_page' %}">
                    <button type="submit" class="btn btn-secondary btn-sm">ALL CATEGORIES</button>
                </a>
            </div>
            <hr>
            <div>
                <h3>Popular Tags</h3>
                {% for tag, count in popular_tags %}
                    {% if tag %}
                        {% with tag_slug=tag|slugify %}
                            {% if tag_slug %}
                                <a href="{% url 'tag_list' tag_slug=tag_slug %}" class="frontpage-tags">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 1024 1024">
                                        <path fill="red" d="m908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5c-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1l-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2c17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9l183.7-179.1c5-4.9 8.3-11.3 9.3-18.3c2.7-17.5-9.5-33.7-27-36.3M664.8 561.6l36.1 210.3L512 672.7L323.1 772l36.1-210.3l-152.8-149L417.6 382L512 190.7L606.4 382l211.2 30.7z"/>
                                    </svg>
                                    {{ tag }} ({{ count }})
                                </a>
                            {% else %}
                                <!-- Debugging: Show a message when tag_slug is empty -->
                                <span class="frontpage-tags error">Invalid tag: {{ tag }}</span>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
                • • • • •
                <a href="{% url 'all_tags_page' %}">
                    <button type="submit" class="btn btn-secondary btn-sm">ALL TAGS</button>
                </a>
            </div>
            <hr>            
        </div>        
    </div>
</div>

    <section class="wrapper">
        <div class="container-fostrap">
            <div>
                <h1 class="heading" id="all-tools">
                    All AI Tools
                </h1>
            </div>
            <div class="content">
                <div class="container">
                    <div class="row">
                        {% for tool in page_obj %}
                        <div class="col-xs-12 col-sm-4">
                            <div class="card">
                                <a class="img-card" href="{% url 'ai_body' slug=tool.slug %}">
                                    <img src="{{ tool.ai_image.url }}" alt="{{ tool.ai_name }}" />
                                </a>
                                <div class="card-content">
                                    <h4 class="card-title">
                                        <a href="{% url 'ai_body' slug=tool.slug %}">
                                            <img src="{{ tool.ai_tool_logo.url }}" alt="{{ tool.ai_name }} Logo" class="logo-img {% if tool.needs_black_bg %}logo-bg-black{% endif %}"/> {{ tool.ai_name }}
                                        </a>
                                    </h4>
                                    <p class="">
                                        {{ tool.ai_short_description|strip_html|truncatechars:80 }} <a href="{% url 'ai_body' slug=tool.slug %}">Learn more</a>
                                    </p>
                                    <p style="font-style: italic;">
                                        Pricing: <i style="color:red;">{{ tool.ai_pricing_tag }}</i>
                                    </p>
                                    <p class="tags">
                                        Tags:
                                        {% for tag in tool.ai_tags|split_tags|slice:":3" %}
                                            <a href="/tags/{{ tag|slugify }}">{{ tag|truncatechars:15 }}</a>{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                        ... 
                                    </p>
                                </div>
                                <div class="card-read-more">
                                    <a href="{% url 'ai_body' slug=tool.slug %}" class="btn btn-link">
                                        DETAIL
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="none" stroke="purple" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 6.5h9.75c2.107 0 3.16 0 3.917.506a3 3 0 0 1 .827.827C22 8.59 22 9.893 22 12M12 6.5l-.633-1.267c-.525-1.05-1.005-2.106-2.168-2.542C8.69 2.5 8.108 2.5 6.944 2.5c-1.816 0-2.724 0-3.406.38A3 3 0 0 0 2.38 4.038C2 4.72 2 5.628 2 7.444V10.5c0 4.179 0 6.505 1.02 8m3.637-2.93l2.062-.056c1.098-.03 1.647-.044 1.98.288c.331.332.316.88.287 1.979l-.055 2.062m-.295-3.979L5 21.5m17-6h-7m7 3h-7m3.5 3H15" color="purple"/></svg>
                                    </a>
                                    <button onclick="openTool('{{ tool.ai_tool_link }}', '{{ tool.ai_name }}', '{{ tool.slug }}', '{{ tool.ai_tool_link }}')" class="btn btn-link">
                                        PREVIEW
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="purple" d="M21.773 14.768c-.029.414-.186.81-.45 1.13a1.892 1.892 0 0 1-.998.63l-3.157.521l-.09.09a.381.381 0 0 0-.09.15l-.5 2.902a1.922 1.922 0 0 1-1.778 1.471h-.09c-.374 0-.74-.111-1.05-.32a1.911 1.911 0 0 1-.739-.92l-2.787-7.906a1.904 1.904 0 0 1 .45-2.001c.253-.263.58-.44.939-.51a1.866 1.866 0 0 1 1.069.07l7.992 2.781c.404.135.754.394 1 .74c.215.351.313.761.28 1.172"/><path fill="purple" d="M9.305 22.243a.834.834 0 0 1-.22 0a10.469 10.469 0 0 1-4.5-2.83a10.491 10.491 0 0 1-2.448-10A10.49 10.49 0 0 1 4.82 4.819a10.467 10.467 0 0 1 9.902-2.765a10.466 10.466 0 0 1 4.669 2.54a10.49 10.49 0 0 1 2.822 4.51a.743.743 0 0 1-1.059.886a.76.76 0 0 1-.37-.436a9.008 9.008 0 0 0-2.41-3.894a8.988 8.988 0 0 0-8.585-2.143a8.989 8.989 0 0 0-3.953 2.306a9.01 9.01 0 0 0-2.377 8.536a8.99 8.99 0 0 0 6.075 6.443a.77.77 0 0 1 .49 1a.75.75 0 0 1-.72.44"/></svg>
                                    </button>
                                    <a href="{{ tool.ai_tool_link }}" class="btn btn-link" target="_blank">
                                        VISIT
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"><path fill="purple" d="M12 22q-2.075 0-3.537-1.463T7 17V7q0-2.075 1.463-3.537T12 2t3.538 1.463T17 7v5h-5v2q-.825 0-1.412.588T10 16q0 .8.588 1.375T12 18zm2 0v-.575q0-1.3 1.25-1.875t2.75-.575t2.75.575T22 21.425V22zm4-4q-.825 0-1.412-.587T16 16t.588-1.412T18 14t1.413.588T20 16t-.587 1.413T18 18m-6-1q-.425 0-.712-.288T11 16t.288-.712T12 15t.713.288T13 16t-.288.713T12 17m0-7q.825 0 1.413-.587T14 8t-.587-1.412T12 6t-1.412.588T10 8t.588 1.413T12 10"/></svg>
                                    </a>
                                </div>
                            </div>                            
                        </div>
                        {% endfor %}
                    </div>
                    <br>
                    <br>
                        <!-- Pagination -->
                        <div class="pagination-container">
                            {% if page_obj.has_other_pages %}
                            <nav>
                                <ul class="pagination">
                                    {% if page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}#all-tools" aria-label="Previous">
                                                <span aria-hidden="true">PREV</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% for num in elided_page_range %}
                                        {% if num == page_obj.paginator.ELLIPSIS %}
                                            <li class="page-item disabled"><span class="page-link">…</span></li>
                                        {% elif num %}
                                            <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                                                <a class="page-link" href="?page={{ num }}#all-tools">{{ num }}</a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                    {% if page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}#all-tools" aria-label="Next">
                                                <span aria-hidden="true">NEXT</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                            {% endif %}
                        </div>                                              
                </div>
            </div>
        </div>
    </section>
    
    
    <!-- Form to jump to a specific page -->
    <div class="container">
        <p><i>OR GO TO A SPECIFIC PAGE</i></p>
        <div class="jump-to-page">
            <form id="jump-to-page-form" method="GET" action="" class="d-flex flex-column align-items" data-max-pages="{{ page_obj.paginator.num_pages }}">
                <div class="form-group">
                    <input class="form-control" type="number" id="page-number-input" name="page" min="1" max="{{ page_obj.paginator.num_pages }}" value="{{ request.GET.page }}" placeholder="Enter number between 1 and {{ page_obj.paginator.num_pages }}" required style="width: 300px; border: 1px solid #ced4da; border-radius: .25rem;">
                </div>
                <div class="form-group mt-2">
                    <button type="submit" class="btn btn-primary">Go</button>
                </div>
            </form>
        </div>
    </div>


        
{% endblock %}