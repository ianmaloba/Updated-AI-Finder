{% extends 'account/base.html' %}

{% block userauthcontent %}
<div class="card shadow-lg border-0 rounded-lg">
    <div class="card-header text-center">
        <h3 class="font-weight-light my-4">Dashboard</h3>
        
        {% load socialaccount %}
        {% load static %}
        
        <div class="mt-4">
            {% if user.is_authenticated %}
                {% if user.socialaccount_set.exists %}
                    {% with account=user.socialaccount_set.first %}
                        {% if account.provider == 'github' %}
                            <img src="{{ account.extra_data.avatar_url }}" class="rounded-circle" alt="" width="100" height="100">
                        {% elif account.provider == 'Google' %}
                            <img src="{{ account.extra_data.picture }}" class="rounded-circle" alt="" width="100" height="100">
                        {% elif account.provider == 'twitter' %}
                            <img src="{{ account.extra_data.profile_image_url_https }}" class="rounded-circle" alt="" width="100" height="100">
                        {% elif account.provider == 'facebook' %}
                            <img src="{{ account.extra_data.picture.data.url }}" class="rounded-circle" alt="" width="100" height="100">
                        {% else %}
                            <img src="{% static 'images/app-logo/default-profile-pic.jpg' %}" class="rounded-circle" alt="" width="100" height="100">
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <img src="{% static 'images/app-logo/default-profile-pic.jpg' %}" class="rounded-circle" alt="" width="100" height="100">
                {% endif %}
            {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24"><path fill="currentColor" d="M12 4a4 4 0 1 1 0 8a4 4 0 0 1 0-8m0 16s8 0 8-2c0-2.4-3.9-5-8-5s-8 2.6-8 5c0 2 8 2 8 2"/></svg>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <h4>Welcome, {{ user.first_name }} {{ user.last_name }}!</h4>
        <ul class="list-group list-group-flush mt-3">
            <li class="list-group-item"><strong>Username:</strong> {{ user.username }}</li>
            <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
            <li class="list-group-item"><strong>Date Joined:</strong> {{ user.date_joined|date:"F d, Y" }}</li>
            <li class="list-group-item"><strong>Last Login:</strong> {{ user.last_login|date:"F d, Y H:i" }}</li>
        </ul>
        {% if user.socialaccount_set.all %}
            <h5 class="mt-4">Connected Accounts:</h5>
            <ul class="list-group list-group-flush">
            {% for account in user.socialaccount_set.all %}
                <li class="list-group-item">{{ account.provider|title }}</li>
            {% endfor %}
            </ul>
        {% endif %}
        <div class="mt-4">
            <div class="row g-2">
                <div class="col-12 col-md-6">
                    <a class="btn btn-primary w-100" href="{% url 'socialaccount_connections' %}">Manage Social Accounts</a>
                </div>
                <div class="col-12 col-md-6">
                    <a class="btn btn-secondary w-100" href="{% url 'account_email' %}">Manage Email Addresses</a>
                </div>
            </div>
        </div>
    </div>

    <div class="card-body">
        <h5 class="mt-5">Your Added Tools:</h5>
        <ul class="list-group">
            <div class="mt-3">
                <p>Number of tools You Added: {{ user_tools|length }}</p>
            </div>
            {% for tool in user_tools %}
                <li class="list-group-item">
                    <strong>{{ tool.ai_name }}</strong> - 
                    <a href="{% url 'ai_body' tool.slug %}">View</a> | 
                    <a href="{% url 'edit_tool' tool.id %}">Edit</a> | 
                    <a href="{% url 'delete_tool' tool.id %}">Delete</a>
                </li>
            {% empty %}
                <li class="list-group-item">You haven't added any tools yet. All Your Added Tools will be listed here!</li>
            {% endfor %}
        </ul>
        <br>
        <a class="nav-link" href="{% url 'add_tool' %}">
            <button type="button" class="btn btn-outline-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24"><path fill="black" d="M3 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 2h10v4h8v10H3zm7 5v3H7v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
              Add New Tool
            </button>
        </a>
        <br>
        <!-- <a class="btn btn-secondary w-50" href="{% url 'user_list' %}">All Tools By Users</a> -->
    </div>
</div>
{% endblock %}